<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>A2UI v0.10 Static Renderer (Minimal)</title>
    <style>
    :root{
  --bg:#f5f7fb;
  --panel:#ffffff;
  --panel2:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --border:rgba(0,0,0,.08);
  --shadow: 0 8px 20px rgba(0,0,0,.06);
  --radius:16px;
  --primary:#2F80ED;
}
    *{box-sizing:border-box}
    body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  background: var(--bg);
  color:var(--text);
}

header{
  padding:14px 18px;
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  gap:12px;
  position:sticky;
  top:0;
  background: #ffffff;
  z-index:10;
}

header .badge{
  font-size:12px;
  padding:4px 10px;
  border:1px solid var(--border);
  border-radius:999px;
  color:var(--muted);
  background: #f3f4f6;
}

.wrap{
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:14px;
  padding:14px;
}
    header .title{
      font-weight:700;
      letter-spacing:.2px;
    }

    .card{
  background: #ffffff;
  border:1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow:hidden;
}

.paneHead{
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  background: #f9fafb;
}
    .paneHead .label{
      font-weight:700;
      font-size:13px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.10em;
    }
    .paneHead .actions{display:flex; gap:8px; flex-wrap:wrap}
    button, .btn{
      appearance:none;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 10px;
      padding:8px 10px;
      font-size:13px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{background: rgba(255,255,255,.08)}
    button:active{transform: translateY(1px)}
    button.primary{
      border-color: color-mix(in srgb, var(--primary) 60%, rgba(255,255,255,.10));
      background: color-mix(in srgb, var(--primary) 20%, rgba(255,255,255,.04));
    }
    .content{
      padding:12px;
    }
    textarea{
  width:100%;
  min-height: 60vh;
  resize: vertical;
  border-radius: 12px;
  border:1px solid var(--border);
  background: #ffffff;
  color: var(--text);
  padding: 12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas;
  font-size: 13px;
  line-height: 1.5;
  outline:none;
}

textarea:focus{
  border-color: var(--primary);
}
    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }
    .error{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,93,93,.35);
      background: rgba(255,93,93,.08);
      color: #ffd6d6;
      font-size: 12.5px;
      white-space: pre-wrap;
    }

    /* Render surface styles */
    .surfaceShell{
  padding:14px;
  background: #ffffff;
  border-radius: 12px;
  border:1px solid var(--border);
  overflow:auto;
}

.surfaceMeta{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius: 12px;
  background: #f9fafb;
  margin-bottom: 12px;
}
    .surfaceMeta .name{
      display:flex; flex-direction:column; gap:3px;
    }
    .surfaceMeta .name .agent{
      font-weight:800;
      font-size:14px;
    }
    .surfaceMeta .name .sid{
      font-size:12px;
      color:var(--muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      white-space:nowrap;
    }

    /* A2UI component rendering */
    .a2ui-col{display:flex; flex-direction:column; gap:10px}
    .a2ui-row{display:flex; flex-direction:row; gap:10px}
    .justify-spaceBetween{justify-content:space-between}
    .justify-start{justify-content:flex-start}
    .justify-center{justify-content:center}
    .justify-end{justify-content:flex-end}
    .align-start{align-items:flex-start}
    .align-center{align-items:center}
    .align-end{align-items:flex-end}
    .align-stretch{align-items:stretch}

    .a2ui-text{color: var(--text); white-space: pre-wrap; word-break: break-word;}
    .t-h1{font-size:28px; font-weight:900; letter-spacing:-.02em}
    .t-h2{font-size:22px; font-weight:850}
    .t-h3{font-size:18px; font-weight:800}
    .t-h4{font-size:16px; font-weight:800}
    .t-h5{font-size:14px; font-weight:800}
    .t-body{font-size:14px; font-weight:500; color: var(--text)}
    .t-caption{font-size:12px; font-weight:650; color: var(--muted); text-transform:none}

    .a2ui-card{
  border:1px solid var(--border);
  background: #ffffff;
  border-radius: 14px;
  padding: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,.05);
}

.a2ui-divider{
  height:1px;
  background: rgba(0,0,0,.10);
}
    .a2ui-divider.v{
      width:1px;
      height:auto;
      align-self: stretch;
    }


    .a2ui-button{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  border-radius: 12px;
  padding: 10px 14px;
  border: 1px solid var(--border);
  background: #f3f4f6;
  cursor:pointer;
  transition: all .15s ease;
}
.a2ui-button:hover{
  background:#e5e7eb;
}    .a2ui-button:active{transform: translateY(1px)}
    .a2ui-button.primary{
  border-color: var(--primary);
  background: var(--primary);
  color: white;
}

.a2ui-button.primary:hover{
  filter: brightness(0.95);
}
    .a2ui-button.borderless{
      border-color: transparent;
      background: transparent;
      padding: 6px 6px;
      text-decoration: underline;
      color: color-mix(in srgb, var(--primary) 85%, white 15%);
    }

    .footerNote{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
    }

    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr; }
      textarea{min-height: 40vh}
      .surfaceShell{min-height: 40vh}
    }

    </style>
</head>

<body>
<header>
    <div class="title">A2UI v0.10 Renderer</div>
    <div class="badge">testing</div>
</header>

<div class="wrap">
    <!-- LEFT: Input -->
    <section class="card">
        <div class="paneHead">
            <div class="label">Input</div>
            <div class="actions">
                <button id="btnLoadSample">Load your sample</button>
                <button class="primary" id="btnRender">Render</button>
                <button id="btnClear">Clear</button>
            </div>
        </div>
        <div class="content">
            <textarea id="input" spellcheck="false"
                      placeholder="Paste A2UI messages here (one JSON per line OR a JSON array)."></textarea>

            <div id="err" class="error" style="display:none;"></div>
        </div>
    </section>

    <!-- RIGHT: Render -->
    <section class="card">
        <div class="paneHead">
            <div class="label">Surface</div>
            <div class="actions">
                <button id="btnExpand">Expand All</button>
                <button id="btnCollapse">Collapse Meta</button>
            </div>
        </div>
        <div class="content">
            <div id="surface" class="surfaceShell">
                <div class="footerNote">Paste messages and click <b>Render</b>.</div>
            </div>
        </div>
    </section>
</div>

<script>
  // ---------------------------
  // Utilities
  // ---------------------------
  function $(id){ return document.getElementById(id); }

  function showError(msg){
    const el = $("err");
    el.style.display = "block";
    el.textContent = msg;
  }
  function clearError(){
    const el = $("err");
    el.style.display = "none";
    el.textContent = "";
  }

  function safeStr(v){
    return (v === null || v === undefined) ? "" : String(v);
  }

  function parseInputToMessages(text){
    const trimmed = text.trim();
    if (!trimmed) return [];

    // Try JSON array first
    if (trimmed.startsWith("[")) {
      const arr = JSON.parse(trimmed);
      if (!Array.isArray(arr)) throw new Error("Expected a JSON array.");
      return arr;
    }

    // Otherwise treat as NDJSON (one JSON object per line)
    const lines = trimmed.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
    const msgs = [];
    for (const line of lines) {
      msgs.push(JSON.parse(line));
    }
    return msgs;
  }

  // ---------------------------
  // A2UI state model (minimal)
  // ---------------------------
  const state = {
    surfaceId: null,
    catalogId: null,
    theme: { primaryColor: "#2F80ED", agentDisplayName: "Agent" },
    componentsById: new Map(),
    rootId: "root",
    // for demo: store last applied messages
    messageCount: 0,
  };

  function resetState(){
    state.surfaceId = null;
    state.catalogId = null;
    state.theme = { primaryColor: "#2F80ED", agentDisplayName: "Agent" };
    state.componentsById = new Map();
    state.rootId = "root";
    state.messageCount = 0;
  }

  // ---------------------------
  // Message application
  // ---------------------------
  function applyMessage(msg){
    if (!msg || typeof msg !== "object") return;

    if (msg.createSurface){
      const cs = msg.createSurface;
      state.surfaceId = cs.surfaceId ?? state.surfaceId;
      state.catalogId = cs.catalogId ?? state.catalogId;

      // apply theme if present
      if (cs.theme && typeof cs.theme === "object") {
        state.theme = {
          ...state.theme,
          ...cs.theme
        };
      }
      state.messageCount++;
      return;
    }

    if (msg.updateComponents){
      const uc = msg.updateComponents;
      if (uc.surfaceId && state.surfaceId && uc.surfaceId !== state.surfaceId){
        // Different surface: for simplicity, reset and treat as new.
        resetState();
        state.surfaceId = uc.surfaceId;
      } else if (uc.surfaceId) {
        state.surfaceId = uc.surfaceId;
      }

      const arr = Array.isArray(uc.components) ? uc.components : [];
      for (const comp of arr){
        if (!comp || typeof comp !== "object") continue;
        if (!comp.id) continue;
        state.componentsById.set(comp.id, comp);
      }
      state.messageCount++;
      return;
    }

    // updateDataModel / deleteSurface not implemented in this minimal renderer
    if (msg.deleteSurface){
      resetState();
      state.messageCount++;
      return;
    }

    state.messageCount++;
  }

  // ---------------------------
  // Rendering
  // ---------------------------
  function renderSurface(){
    const host = $("surface");
    host.innerHTML = "";

    const primary = state.theme?.primaryColor || "#2F80ED";
    document.documentElement.style.setProperty("--primary", primary);

    // Meta header
    const meta = document.createElement("div");
    meta.className = "surfaceMeta";
    meta.innerHTML = `
      <div class="name">
        <div class="agent">${escapeHtml(safeStr(state.theme?.agentDisplayName || "Agent"))}</div>
        <div class="sid">surfaceId: ${escapeHtml(safeStr(state.surfaceId || "(none)"))}</div>
      </div>
      <div class="pill">messages applied: ${state.messageCount}</div>
    `;
    host.appendChild(meta);

    if (!state.surfaceId) {
      host.appendChild(note("No surface created yet. Paste a createSurface message first."));
      return;
    }
    if (!state.componentsById.size) {
      host.appendChild(note("No components yet. Paste an updateComponents message."));
      return;
    }

    const root = state.componentsById.get(state.rootId);
    if (!root) {
      host.appendChild(note(`Missing component with id "${state.rootId}". (A2UI requires it)`));
      return;
    }

    // Build DOM for root
    const tree = renderComponentById(state.rootId, new Set());
    if (!tree) {
      host.appendChild(note("Could not render root."));
      return;
    }
    host.appendChild(tree);
  }

  function note(text){
    const d = document.createElement("div");
    d.className = "footerNote";
    d.textContent = text;
    return d;
  }

  function renderComponentById(id, visiting){
    if (visiting.has(id)) {
      const cyc = document.createElement("div");
      cyc.className = "error";
      cyc.textContent = `Cycle detected at component id "${id}".`;
      return cyc;
    }
    visiting.add(id);

    const c = state.componentsById.get(id);
    if (!c) {
      const missing = document.createElement("div");
      missing.className = "error";
      missing.textContent = `Missing referenced component id "${id}".`;
      visiting.delete(id);
      return missing;
    }

    const type = c.component;
    let el = null;

    switch(type){
      case "Text": el = renderText(c); break;
      case "Divider": el = renderDivider(c); break;
      case "Column": el = renderColumn(c, visiting); break;
      case "Row": el = renderRow(c, visiting); break;
      case "Card": el = renderCard(c, visiting); break;
      case "Button": el = renderButton(c, visiting); break;
      default:
        el = document.createElement("div");
        el.className = "error";
        el.textContent = `Unsupported component: ${type} (id: ${id}).`;
        break;
    }

    visiting.delete(id);
    return el;
  }

  function renderText(c){
    const d = document.createElement("div");
    d.className = "a2ui-text " + variantClass(c.variant);
    d.textContent = safeStr(c.text);
    return d;
  }

  function variantClass(v){
    switch (v) {
      case "h1": return "t-h1";
      case "h2": return "t-h2";
      case "h3": return "t-h3";
      case "h4": return "t-h4";
      case "h5": return "t-h5";
      case "caption": return "t-caption";
      case "body":
      default: return "t-body";
    }
  }

  function renderDivider(c){
    const d = document.createElement("div");
    d.className = "a2ui-divider" + (c.axis === "vertical" ? " v" : "");
    return d;
  }

  function renderColumn(c, visiting){
    const d = document.createElement("div");
    d.className = "a2ui-col " + justifyClass(c.justify) + " " + alignClass(c.align);

    const children = normalizeChildren(c.children);
    for (const childId of children){
      d.appendChild(renderComponentById(childId, visiting));
    }
    return d;
  }

  function renderRow(c, visiting){
    const d = document.createElement("div");
    d.className = "a2ui-row " + justifyClass(c.justify) + " " + alignClass(c.align);

    const children = normalizeChildren(c.children);
    for (const childId of children){
      d.appendChild(renderComponentById(childId, visiting));
    }
    return d;
  }

  function justifyClass(j){
    switch(j){
      case "spaceBetween": return "justify-spaceBetween";
      case "center": return "justify-center";
      case "end": return "justify-end";
      case "start":
      default: return "justify-start";
    }
  }

  function alignClass(a){
    switch(a){
      case "center": return "align-center";
      case "end": return "align-end";
      case "stretch": return "align-stretch";
      case "start":
      default: return "align-start";
    }
  }

  function renderCard(c, visiting){
    const d = document.createElement("div");
    d.className = "a2ui-card";
    const childId = c.child;
    if (!childId) {
      d.appendChild(note("Card missing 'child'"));
      return d;
    }
    d.appendChild(renderComponentById(childId, visiting));
    return d;
  }

  function renderButton(c, visiting){
    const btn = document.createElement("div");
    btn.className = "a2ui-button " + (c.variant === "borderless" ? "borderless" : (c.variant === "primary" ? "primary" : ""));

    const childId = c.child;
    if (childId) btn.appendChild(renderComponentById(childId, visiting));
    else btn.textContent = "Button";

    const actionId = c.action && c.action.actionId ? String(c.action.actionId) : null;
    btn.addEventListener("click", () => {
      // Demo behavior: show actionId
      alert(actionId ? `Button clicked\nactionId: ${actionId}` : "Button clicked (no actionId)");
    });

    return btn;
  }

  function normalizeChildren(children){
    // In spec, ChildList can be array of strings OR template object. We support only string arrays here.
    if (Array.isArray(children)) return children.map(String);
    if (children && typeof children === "object" && Array.isArray(children.explicitList)) return children.explicitList.map(String);
    return [];
  }

  function escapeHtml(str) {
    return str.replace(/[&<>"']/g, s => ({
      "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
    }[s]));
  }

  // ---------------------------
  // Wire up UI
  // ---------------------------
  const sample = `{"version":"v0.10","createSurface":{"sendDataModel":false,"surfaceId":"surface-chat-123","theme":{"agentDisplayName":"Agent","primaryColor":"#2F80ED"},"catalogId":"https://a2ui.org/specification/v0_10/standard_catalog.json"}}
{"version":"v0.10","updateComponents":{"surfaceId":"surface-chat-123","components":[{"id":"root","component":"Column","children":["root-column"]},{"id":"root-column","component":"Column","children":["text_1","div_2","card_3","div_18","btn_19"],"justify":"start","align":"stretch"},{"text":"Here is a summary of your account balances.","id":"text_1","component":"Text","variant":"body"},{"axis":"horizontal","id":"div_2","component":"Divider"},{"child":"col_4","id":"card_3","component":"Card"},{"text":"Account Balances","id":"text_5","component":"Text","variant":"h3"},{"axis":"horizontal","id":"div_6","component":"Divider"},{"text":"Account","id":"cell_8","component":"Text","variant":"caption"},{"text":"Balance","id":"cell_9","component":"Text","variant":"caption"},{"align":"center","justify":"spaceBetween","id":"row_7","component":"Row","children":["cell_8","cell_9"]},{"axis":"horizontal","id":"div_10","component":"Divider"},{"text":"Checking","id":"cell_12","component":"Text","variant":"body"},{"text":"$12,430","id":"cell_13","component":"Text","variant":"body"},{"align":"center","justify":"spaceBetween","id":"row_11","component":"Row","children":["cell_12","cell_13"]},{"axis":"horizontal","id":"div_14","component":"Divider"},{"text":"Savings","id":"cell_16","component":"Text","variant":"body"},{"text":"$8,900","id":"cell_17","component":"Text","variant":"body"},{"align":"center","justify":"spaceBetween","id":"row_15","component":"Row","children":["cell_16","cell_17"]},{"id":"col_4","component":"Column","children":["text_5","div_6","row_7","div_10","row_11","div_14","row_15"],"justify":"start","align":"stretch"},{"axis":"horizontal","id":"div_18","component":"Divider"},{"text":"Download Statement","id":"btnText_20","component":"Text","variant":"body"},{"id":"btn_19","component":"Button","variant":"primary","child":"btnText_20","action":{"actionId":"download_statement"}}]}}`;

  $("btnLoadSample").addEventListener("click", () => {
    $("input").value = sample;
    clearError();
  });

  $("btnClear").addEventListener("click", () => {
    $("input").value = "";
    resetState();
    renderSurface();
    clearError();
  });

  $("btnRender").addEventListener("click", () => {
    clearError();
    try{
      const text = $("input").value;
      const msgs = parseInputToMessages(text);

      resetState();
      for (const m of msgs) applyMessage(m);

      renderSurface();
    } catch (e) {
      showError(e && e.stack ? e.stack : String(e));
    }
  });

  $("btnExpand").addEventListener("click", () => {
    // Just scroll top for convenience
    $("surface").scrollTop = 0;
  });

  $("btnCollapse").addEventListener("click", () => {
    // Hide meta block (demo)
    const meta = $("surface").querySelector(".surfaceMeta");
    if (meta) meta.style.display = (meta.style.display === "none") ? "" : "none";
  });

  // initial render
  resetState();
  renderSurface();

</script>
</body>
</html>
